Chapter 3 Linux 用户和权限
=================================
## Section 3.1 root用户
### 1.root用户 vs 普通用户
Windows，MacOS，Linux等系统均采用多用户的管理模式进行权限管理。在Linux系统中，拥有最大权限的账户名为root（超级管理员），root用户拥有最大的系统操作权限，而普通用户在很多地方的权限受到限制。

**例子**：普通用户无法在根目录下创建文件，但是root用户可以；
- 普通用户的权限一般在其home目录内是不受限的；
- 一旦出了home目录，普通用户基本只有**只读**和**执行**权限，没有修改权限；

### 2.切换用户的命令

#### (1) 切换到[用户名]用户
```
su [-] [用户名]
```
#### (2) 回退到上一个用户
```
exit
```
- 使用普通用户切换到root用户，需要输入密码，反之不需要；
- 如果不指定用户名，则默认向root用户切换；

### 3.`sudo`用户
#### (1) `sudo`语法
在我们得知root密码的时候，可以通过su命令切换到root用户得到最大权限，但是不建议长期使用root用户，避免给系统带来破坏。此时，可以使用`sudo`命令，使得普通用户临时以root身份运行。
```
sudo 其他命令
```

- 在其他命令之前带上`sudo`，即可为这一条命令临时赋予root授权；
- 但并不是所有用户都可以使用`sudo`，我们需要为普通用户设置`sudo`认证；


#### (2) 为普通用户配置`sudo`认证
- 切换到root用户，执行`visodu`命令，会自动通过vi编辑器打开：`/etc/sudoers`
- 在文件的最后一行添加
  ```
  普通用户用户名 ALL = (ALL) NOPASSWD: ALL
  ```
- 通过`:wq`保存
- 切换回普通用户
- 执行的命令均已root执行
  
## Section 3.2用户和用户组
### 1.用户和用户组
在Linux系统中可以配置多个用户以及多个用户组，用户可以加个多个用户组中；

Linux中关于权限的管控级别有两个级别，分别是
- 针对用户的权限控制
- 针对用户组的权限控制

### 2.用户组管理
以下命令需要root用户执行
**创建用户组**
```
groupadd 用户组名
```
**删除用户组**
```
groupdel 用户组名
```

### 3.用户管理
以下命令需要root用户执行

**创建用户**
```
useradd [-g -d] 用户名
```
- 选项： `-g` 指定用户的组，不指定-g，会创建同名字的组并自动加入；指定`-g`需要租已经存在，如已经存在同名组，必须使用`-g`；
- 选项： `-d` 指定用户Home路径，不指定，home目录默认在`/home/用户名`；

**删除用户**
```
userdel [-r] 用户名`
```

- 选项： `-r`，删除用户的home目录，不使用-r时，home目录保留
- 注意： 当我们想删除某个用户的时候，出现 user $\mathbf{x x x}$ is currently used by process $\mathbf{x x x}$ ，可能的原因是你创建用户user1之后，使用su命令切换到user1用户下，之后又想删除user1用户，使用su root切换到root用户下，使用userdel user1。出现上述情况的根本原因在于切换回root用户之后，user1还被某个进程占用。解决方案是使用`ctrl+d` (退出当前用户)。第一次使用`ctrl+d`退出root用户，回到user1用户；第二次使用ctrl+d退出user1用户，此时会返回到root用户（再按`ctrl+d`退出登陆连接），此时使用`userdel user1`正常删除。

**查看用户所属组**
```
id [用户名]
```

- 参数： 用户名，被查看的用户，如果不提则查看自身

**修改用户所属组**
```
usermod -aG 用户组 用户名
```
将指定用户加到指定用户组

**查看用户/用户组**
```
getent passwd
```
查看系统中有哪些用户，对于每个返回有七个信息
```
用户名：密码(x)：用户id：组id：描述信息：home目录：执行终端（默认bash)
```

```
getent group
```
查看系统中有哪些用户组，对于每个返回有三个信息
```
组名称：组认证：组id
```

## Section 3.3 查看权限管控信息
### 1.认知权限信息
通过`ls -l`我们可以列表形式查看内容，以及显示权限细节
- 序号1：表示文件，文件夹的权限控制信息；
- 序号2：表示文件，文件夹所属用户；
- 序号3：表示文件，文件夹所属用户组；

  序号1一共有10个槽位：
  - 第1位表示类型：d表示文件夹，l表示软链接，-表示文件；
  - 第2-4位表示所属用户权限，第5-7位表示所属用户组权限，第8-10位表示其他用户权限，均为`-r-w-x`顺序，`-`表示没有该权限；
  - 针对文件和文件夹`-r-w-x`的意义有细微的不同；
    
  |权限 |名称|描述|
  |:---:|:---:|:---:|
  |`r`| 读权限|针对文件可以查看内容；针对文件夹可以查看文件夹内容，如`ls`命令；|
  |`w`|写权限|针对文件可以修改此文件；针对文件夹可创建，删除，改名等；|
  |`x`|执行权限|针对文件表示可以将文件作为执行程序；针对文件夹可以更改目录进入此文件夹；|


### 2.`chmod`命令
我们可以使用chmod命令修改文件，文件夹的权限信息。注意只有文件，文件夹的所属用户或root用户可以修改；
```
chmod [-R] 权限 文件或文件夹
```
- 选项：`-R`，对文件夹内的全部内容应用同样的操作；
- 示例： `chmod u=rwx, g=rx, o=x hello.txt`，其中u代表user，g代表group，o代表others，其权限信息改为了`rwxr-x--x`；
- 示例： `chmod -R u=rwx, g=rx, o=x test`，不仅修改了test文件夹的权限，还把其中所有的文件的权限也改为了`rwxr-x--x`；

另外，我们还可以用数字去代表权限，这里利用了二进制的想法。
|数字 |0 |1 |2 |3 |4 |5|6|7|8|
|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|:---:|
|权限|---|--x|-w-|-wx|r--|r-x|rw-|rwx|
